# Пример работы с API сервиса

## Как пользоваться сервисом:
### Для индекса, который хотите предсказать, нужно получить список требуемых признаков.
    
__Признак - временной ряд из озера данных, который нейросеть использует для предсказания индекса.__
    
Например, для индекса промышленного производства (ИПП) это будут новостной индекс, Погрузка на сети РЖД, и так далее
    
Получить их можно по GET запросу data.vavt.ru/forecast/api/v1/{имя_индекса}/features_list
    
Например, для индекса промышленного производства (ipp) по GET запросу data.vavt.ru/forecast/api/v1/ipp/features_list будет такой результат:

```json
{
    "features": {
        "news": {
            "description": "Новостной индекс ЦБ, Россия",
            "database_uuid": "423f7092-d29b-43da-8209-f100c1fc88cd"
        },
        "rzd": {
            "description": "Погрузка на сети РЖД, млн тонн, Россия",
            "database_uuid": "61265b19-7635-449c-9538-b45e078fb5e9"
        },
        ...
    }
}
```

__Схема ответа для всех индексов будет одинаковая, будет меняться число признаков, их название и uuid.__

В ответе вам будет полезен database_uuid и название признаков ("news", "rzd", ... )
Описание ("description") может помочь убедиться, что берете и отдаете нужные данные

### Далее, получаем из озера данных данные каждого индекса по database_uuid

Важно отметить, что вся предобработка данных происходит на нашей стороне. Агрегацию по месяцам и фильтрацию по дате проводить не нужно.

Нам нужно сохранить значения и временные отметки индекса. Все индексы начинаются с разного периода времени, для этого нужно их хранить чтобы правильно отрезать нужный период времени, также для агреггации ежедневных данных в помесячные

#### пример нужных данных:

```json
{
    "ipp": {
        "values": [110.6, 113.3, ...],
        "dates":  ["31.01.2000", "29.02.2000", ...]
    }
}
```

Все временные ряды будут иметь такую структуру в запросе. Важно, чтобы значения и отметки времени были одной длины, иначе вернется ошибка валидации

### После этого можно сформировать запрос для предсказания. 

Для этого нужно от пользователя получить список гиперпараметров модели и доверительный интервал.
Например, для модели CatBoost они могут быть следующими:

```json
{
    "depth": 3,
    "learning_rate": 0.1,
    "l2_leaf_reg": 0.005,
    "iterations": 8
}
```

и доверительный интервал:

```json
{
    "confidence_interval": "90%"    
}
```

Важно, что в нашем сервисе, параметр confidence_interval наследуется от Enum со следующими возможными значениями:

```python
class ConfidenceIntervalEnum(str, Enum):
    '''Доверительный интервал'''

    low = '90%'
    medium = '95%'
    hight = '99%'
```

Поэтому другие значения не пропустит pydantic

#### Составляем параметры запроса
Получить прогноз можно по POST запросу по пути data.vavt.ru/forecast/api/v1/{имя_индекса}/{название_модели_ML}

Например, для предсказания индекса промышленного производства с помощью CatBoost этот путь будет иметь вид:
data.vavt.ru/forecast/api/v1/ipp/catboost

и параметры будут следующими:

```json
{
    "hparams": {
        "depth": 3,
        "learning_rate": 0.1,
        "l2_leaf_reg": 0.005,
        "iterations": 8
    },
    "confidence_interval": "90%",
    "ipp": {
        "values": [110.6, 113.3, ... ],
        "dates":  ["31.01.2000", "29.02.2000", ... ]
    },
    "features": {
        "news": {
            "values": [1.283100603, 1.31661417, ... ],
            "dates": ["01.02.2004", "01.03.2004", ... ]
        }
    } 
}
```

После чего вы получите ответ в следующем формате:

```json
{
    "month_1": 123.0, 
    "month_2": 456.0,
    "month_3": 789.0,
}
```

Это прогноз на 1, 2 и 3 месяца.
## Пример кода 
Пример кода по каждому пункту можно найти в файле get_forecast.py
```

